<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ಕನ್ನಡಿಗ • KANNADIGA</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;1,400&family=Noto+Serif+Kannada:wght@600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">

    <!-- Prevent FOUC -->
    <style>
        .loading-text-left,
        .container,
        .bottom-text,
        .loading-text-right,
        .welcome-text,
        .enter-button {
            visibility: hidden;
        }
    </style>
</head>
<body>

<!-- Custom Cursor Element -->
<div id="custom-cursor"></div>

<!-- LEFT TEXT -->
<div class="loading-text-left">ಸಿರಿಗನ್ನಡಂ ಗೆಲ್ಗೆ &nbsp; • &nbsp; ಸಿರಿಗನ್ನಡಂ ಬಾಳ್ಗೆ</div>

<!-- CENTER: Logo Container -->
<div class="container" id="interaction-container">
    <div class="logo-wrapper" id="logoWrapper">
        <!-- SVG injected here -->
    </div>

    <!-- NEW: Final Sequence Content (Text + Button) -->
    <div class="final-sequence-content">
        <div class="welcome-text">ನಿಮಗೆ<br>ಆತ್ಮೀಯ ಸ್ವಾಗತ.</div>
        <button class="enter-button">ಪ್ರವೇಶಿಸಿ</button>
    </div>
</div>

<!-- BOTTOM TEXT -->
<div class="bottom-text" id="loadingCounter">೦೦

</div>

<!-- RIGHT TEXT -->
<div class="loading-text-right">ಕನ್ನಡಿಗ</div>

<script>
    // --- CONFIGURATION ---
    const preloadColors = ['#FF0000', '#FFCF03', '#00C907', '#9A00EB', '#F2059F'];

    // Elements
    const logoWrapperEl = document.getElementById('logoWrapper');
    const counterEl = document.getElementById('loadingCounter');
    const kannadaDigits = ['೦','೧','೨','೩','೪','೫','೬','೭','೮','೯'];

    function toKannadaNum(num) {
        const numStr = num.toString().padStart(2, '0');
        return numStr.split('').map(digit => kannadaDigits[parseInt(digit)]).join('');
    }

    // --- GSAP ENTRANCE ANIMATION ---
    function runIntroAnimation() {
        const tl = gsap.timeline({
            onComplete: startAppLogic
        });

        const topRowElements = [
            '.loading-text-left',
            '.container',
            '.loading-text-right'
        ];
        const kannadaElement = '.bottom-text';

        // 1. Strict Initialization for Centering
        gsap.set(".container", {
            xPercent: -50,
            yPercent: -50
        });

        gsap.set([".loading-text-left", ".loading-text-right"], {
            yPercent: -50
        });

        gsap.set(kannadaElement, {
            xPercent: -50,
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // Initialize New Elements as Hidden
        gsap.set([".welcome-text", ".enter-button"], {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 2. Initialize Shared Start State
        gsap.set(topRowElements, {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 3. Animate Top Row
        tl.to(topRowElements, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            stagger: 0,
            ease: "expo.inOut",
            clearProps: "filter" // Ensure blur is removed to prevent rasterization
        })
        // 4. Animate Bottom Text
        .to(kannadaElement, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            ease: "expo.inOut",
            clearProps: "filter" // Ensure blur is removed
        }, "-=1.9");
    }

    // --- GSAP EXIT ANIMATION & WELCOME SEQUENCE ---
    function runExitAnimation() {
        const tl = gsap.timeline();

        const container = document.querySelector('.container');
        const kannadaText = document.querySelector('.bottom-text');
        const leftText = document.querySelector('.loading-text-left');
        const rightText = document.querySelector('.loading-text-right');

        // New Elements
        const welcomeText = document.querySelector('.welcome-text');
        const enterButton = document.querySelector('.enter-button');
        const finalContent = document.querySelector('.final-sequence-content');

        // --- DYNAMIC CENTERING CALCULATION ---
        // To center the entire group (Logo + Gap + Text + Button), we calculate the height
        // of the content added below the logo and shift the whole container UP by half that amount.
        const gap = 48; // Defined in CSS margin-top
        const contentHeight = finalContent.offsetHeight;
        const moveUpDistance = (gap + contentHeight) / 2;

        // --- ANIMATION TIMELINE ---
        tl
        // Step 1: Fade out ALL loading text
        .to([leftText, rightText, kannadaText], {
            duration: 1.5,
            y: -50,
            autoAlpha: 0,
            filter: "blur(10px)",
            ease: "expo.inOut"
        })
        // Step 2: Move Container UP based on content height to center everything
        .to(container, {
            duration: 1.5,
            y: `-=${moveUpDistance}`,
            ease: "expo.inOut"
        }, "<")
        // Step 3: Animate Welcome Text & Button IN
        // Overlap set to -0.8s to appear smoothly while logo is finishing its move
        .to([welcomeText, enterButton], {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            stagger: 0.1,
            ease: "expo.out",
            clearProps: "filter"
        }, "-=0.8");
    }

    // --- APP LOGIC ---
    let colorInterval;
    let lastColorIndex = -1;

    function startAppLogic() {
        startColorCycle();
        startCounter();
    }

    function startColorCycle() {
        const setRandomColor = () => {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * preloadColors.length);
            } while (newIndex === lastColorIndex);
            lastColorIndex = newIndex;
            logoWrapperEl.style.backgroundColor = preloadColors[newIndex];
        };
        setRandomColor();
        colorInterval = setInterval(setRandomColor, 300);
    }

    function stopColorCycle() {
        clearInterval(colorInterval);
    }

    function startCounter() {
        const progress = { val: 0 };
        gsap.to(progress, {
            val: 100,
            duration: 3,
            ease: "expo.inOut",
            onUpdate: function() {
                counterEl.textContent = toKannadaNum(Math.floor(progress.val));
            },
            onComplete: function() {
                stopColorCycle();
                runExitAnimation();
            }
        });
    }

    // --- INIT ---
    fetch('assets/metal.svg')
        .then(response => response.text())
        .then(svgContent => {
            document.getElementById('logoWrapper').innerHTML = svgContent;
            runIntroAnimation();
            if (window.initSVGLights) window.initSVGLights();
        })
        .catch(err => {
            console.error('Error loading SVG:', err);
            startAppLogic();
        });

</script>
<script src="script.js"></script>
</body>
</html>