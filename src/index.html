<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ಕನ್ನಡಿಗ • KANNADIGA</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- CHANGED: Removed Noto Sans Kannada (now local), Kept Inter and Noto Serif Kannada -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;1,400&family=Noto+Serif+Kannada:wght@600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">

    <!-- Prevent FOUC -->
    <style>
        .loading-text-left,
        .container,
        .kannada-text,
        .loading-text-right,
        .definition-wrapper {
            visibility: hidden;
        }
    </style>
</head>
<body>

<!-- Custom Cursor Element -->
<div id="custom-cursor"></div>

<!-- LEFT TEXT -->
<div class="loading-text-left">ಸಿರಿಗನ್ನಡಂ ಗೆಲ್ಗೆ . ಸಿರಿಗನ್ನಡಂ ಬಾಳ್ಗೆ</div>

<!-- CENTER: Logo Container -->
<div class="container" id="interaction-container">
    <div class="logo-wrapper" id="logoWrapper">
        <!-- SVG injected here -->
    </div>
</div>

<!-- BOTTOM TEXT -->
<div class="kannada-text">ಕನ್ನಡಿಗ</div>

<!-- RIGHT TEXT -->
<div class="loading-text-right" id="loadingCounter">೦೦</div>

<!-- NEW: Definition Text Wrapper -->
<div class="definition-wrapper">
    <p class="def-text def-pronunciation">♪ kannaḍiga</p>
    <p class="def-text def-noun">noun</p>
    <p class="def-text def-desc">a man whose mother tongue is Kannaḍa;<br>a man belonging to Karnāṭaka.</p>
</div>

<script>
    // --- CONFIGURATION ---
    const preloadColors = ['#FF0000', '#FFCF03', '#00C907', '#9A00EB', '#F2059F'];

    // Elements
    const logoWrapperEl = document.getElementById('logoWrapper');
    const counterEl = document.getElementById('loadingCounter');
    const kannadaDigits = ['೦','೧','೨','೩','೪','೫','೬','೭','೮','೯'];

    function toKannadaNum(num) {
        const numStr = num.toString().padStart(2, '0');
        return numStr.split('').map(digit => kannadaDigits[parseInt(digit)]).join('');
    }

    // --- GSAP ENTRANCE ANIMATION ---
    function runIntroAnimation() {
        const tl = gsap.timeline({
            onComplete: startAppLogic
        });

        const topRowElements = [
            '.loading-text-left',
            '.container',
            '.loading-text-right'
        ];
        const kannadaElement = '.kannada-text';

        // 1. Strict Initialization for Centering
        gsap.set(".container", {
            xPercent: -50,
            yPercent: -50
        });

        gsap.set([".loading-text-left", ".loading-text-right"], {
            yPercent: -50
        });

        gsap.set(kannadaElement, {
            xPercent: -50,
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 2. Initialize Shared Start State
        gsap.set(topRowElements, {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 3. Animate Top Row
        tl.to(topRowElements, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            stagger: 0,
            ease: "expo.inOut"
        })
        // 4. Animate Bottom Text
        .to(kannadaElement, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            ease: "expo.inOut"
        }, "-=1.9");
    }

    // --- GSAP EXIT ANIMATION ---
    function runExitAnimation() {
        const tl = gsap.timeline();

        const container = document.querySelector('.container');
        const kannadaText = document.querySelector('.kannada-text');
        const leftText = document.querySelector('.loading-text-left');
        const rightText = document.querySelector('.loading-text-right');
        const defWrapper = document.querySelector('.definition-wrapper');
        const defLines = document.querySelectorAll('.def-text');

        // --- DYNAMIC CALCULATIONS ---
        const containerRect = container.getBoundingClientRect();
        const textRect = kannadaText.getBoundingClientRect();

        // 1. Calculate Visual Alignment
        // We need to know how wide the text WILL be at 32px to align definitions to its start.
        const currentFontSize = window.getComputedStyle(kannadaText).fontSize;
        kannadaText.style.fontSize = "32px"; // Temporarily set to final size
        const titleWidthAt32 = kannadaText.offsetWidth;
        kannadaText.style.fontSize = currentFontSize; // Reset immediately

        // Calculate left position: Center of screen - half of title width
        const screenCenter = window.innerWidth / 2;
        const titleLeftStart = screenCenter - (titleWidthAt32 / 2);

        // Fix Anchor for Text Growth
        gsap.set(kannadaText, {
            top: textRect.top,
            bottom: "auto",
            y: 0
        });

        // 2. Calculate Vertical Moves
        const targetLogoTop = 140;
        const logoMoveY = targetLogoTop - containerRect.top;

        const targetTextTop = targetLogoTop + containerRect.height + 16;
        const textMoveY = targetTextTop - textRect.top;

        // 3. Position Definition Wrapper
        // We place it vertically below the final title position.
        // We place it horizontally at the EXACT start of the title.
        const titleHeightApprox = 48;
        const defStartY = targetTextTop + titleHeightApprox + 16;

        gsap.set(defWrapper, {
            top: defStartY,
            left: titleLeftStart, // Align specifically to the left edge
            xPercent: 0, // Remove centering transform so 'left' is absolute
            autoAlpha: 1,
            visibility: "visible"
        });

        gsap.set(defLines, {
            autoAlpha: 0,
            y: 20,
            filter: "blur(10px)"
        });

        // --- ANIMATION TIMELINE ---
        tl
        // Step 1: Fade out side texts
        .to([leftText, rightText], {
            duration: 1.5,
            y: -50,
            autoAlpha: 0,
            filter: "blur(10px)",
            ease: "expo.inOut"
        })
        // Step 2: Move Logo UP
        .to(container, {
            duration: 1.5,
            y: "+=" + logoMoveY,
            ease: "expo.inOut"
        }, "<")
        // Step 3: Move Title UP & Scale
        .to(kannadaText, {
            duration: 1.5,
            y: "+=" + textMoveY,
            fontSize: "32px",
            ease: "expo.inOut"
        }, "<")
        // Step 4: Animate Definitions IN
        .to(defLines, {
            duration: 0.8, // Faster appear
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            stagger: 0.1, // Faster stagger
            ease: "expo.out"
        }, "-=0.5");
    }

    // --- APP LOGIC ---
    let colorInterval;
    let lastColorIndex = -1;

    function startAppLogic() {
        startColorCycle();
        startCounter();
    }

    function startColorCycle() {
        const setRandomColor = () => {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * preloadColors.length);
            } while (newIndex === lastColorIndex);
            lastColorIndex = newIndex;
            logoWrapperEl.style.backgroundColor = preloadColors[newIndex];
        };
        setRandomColor();
        colorInterval = setInterval(setRandomColor, 300);
    }

    function stopColorCycle() {
        clearInterval(colorInterval);
    }

    function startCounter() {
        const progress = { val: 0 };
        gsap.to(progress, {
            val: 100,
            duration: 3,
            ease: "expo.inOut",
            onUpdate: function() {
                counterEl.textContent = toKannadaNum(Math.floor(progress.val));
            },
            onComplete: function() {
                stopColorCycle();
                runExitAnimation();
            }
        });
    }

    // --- INIT ---
    fetch('assets/metal.svg')
        .then(response => response.text())
        .then(svgContent => {
            document.getElementById('logoWrapper').innerHTML = svgContent;
            runIntroAnimation();
            if (window.initSVGLights) window.initSVGLights();
        })
        .catch(err => {
            console.error('Error loading SVG:', err);
            startAppLogic();
        });

</script>
<script src="script.js"></script>
</body>
</html>