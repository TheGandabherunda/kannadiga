<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ಕನ್ನಡಿಗ • KANNADIGA</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;1,400&family=Noto+Serif+Kannada:wght@600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">

    <!-- Prevent FOUC -->
    <style>
        .loading-text-left,
        .container,
        .bottom-text,
        .loading-text-right,
        .welcome-text,
        .enter-button {
            visibility: hidden;
        }
    </style>
</head>
<body>

<!-- Custom Cursor Element -->
<div id="custom-cursor"></div>

<!-- LEFT TEXT -->
<div class="loading-text-left">ಸಿರಿಗನ್ನಡಂ ಗೆಲ್ಗೆ &nbsp; • &nbsp; ಸಿರಿಗನ್ನಡಂ ಬಾಳ್ಗೆ</div>

<!-- CENTER: Logo Container -->
<div class="container" id="interaction-container">
    <div class="logo-wrapper" id="logoWrapper">
        <!-- SVG injected here -->
    </div>

    <!-- NEW: Final Sequence Content (Text + Button) -->
    <div class="final-sequence-content">
        <div class="welcome-text">ನಿಮಗೆ<br>ಆತ್ಮೀಯ ಸ್ವಾಗತ.</div>
        <button class="enter-button">ಪ್ರವೇಶಿಸಿ</button>
    </div>
</div>

<!-- BOTTOM TEXT -->
<div class="bottom-text" id="loadingCounter">೦೦

</div>

<!-- RIGHT TEXT -->
<div class="loading-text-right">ಕನ್ನಡಿಗ</div>

<script>
    // --- CONFIGURATION ---
    const preloadColors = ['#FF0000', '#FFCF03', '#00C907', '#9A00EB', '#F2059F'];

    // Elements
    const logoWrapperEl = document.getElementById('logoWrapper');
    const counterEl = document.getElementById('loadingCounter');
    const kannadaDigits = ['೦','೧','೨','೩','೪','೫','೬','೭','೮','೯'];

    function toKannadaNum(num) {
        const numStr = num.toString().padStart(2, '0');
        return numStr.split('').map(digit => kannadaDigits[parseInt(digit)]).join('');
    }

    // --- GSAP ENTRANCE ANIMATION ---
    function runIntroAnimation() {
        const tl = gsap.timeline({
            onComplete: startAppLogic
        });

        const topRowElements = [
            '.loading-text-left',
            '.container',
            '.loading-text-right'
        ];
        const kannadaElement = '.bottom-text';

        // 1. Strict Initialization for Centering
        gsap.set(".container", {
            xPercent: -50,
            yPercent: -50
        });

        gsap.set([".loading-text-left", ".loading-text-right"], {
            yPercent: -50
        });

        gsap.set(kannadaElement, {
            xPercent: -50,
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // Initialize New Elements as Hidden
        gsap.set([".welcome-text", ".enter-button"], {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 2. Initialize Shared Start State
        gsap.set(topRowElements, {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)"
        });

        // 3. Animate Top Row
        tl.to(topRowElements, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            stagger: 0,
            ease: "expo.inOut",
            clearProps: "filter"
        })
        // 4. Animate Bottom Text
        .to(kannadaElement, {
            duration: 2.0,
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            ease: "expo.inOut",
            clearProps: "filter"
        }, "-=1.9");
    }

    // --- GSAP EXIT ANIMATION & WELCOME SEQUENCE ---
    function runExitAnimation() {
        const btn = document.querySelector('.enter-button');

        // Ensure button is clean (no transition) before starting animation
        btn.classList.remove('interactive');

        const tl = gsap.timeline({
            onComplete: () => {
                // IMPORTANT: Enable CSS interactions (transition) only AFTER animation is done.
                btn.classList.add('interactive');
            }
        });

        const container = document.querySelector('.container');
        const kannadaText = document.querySelector('.bottom-text');
        const leftText = document.querySelector('.loading-text-left');
        const rightText = document.querySelector('.loading-text-right');

        const welcomeText = document.querySelector('.welcome-text');
        const enterButton = document.querySelector('.enter-button');
        const finalContent = document.querySelector('.final-sequence-content');

        // --- CALCULATE START POSITIONS ---
        const bottomTextRect = kannadaText.getBoundingClientRect();
        const welcomeRect = finalContent.getBoundingClientRect();

        // Calculate the vertical difference
        const fullDistanceY = (bottomTextRect.top + bottomTextRect.height / 2) - (welcomeRect.top + welcomeRect.height / 2);

        const startY = fullDistanceY * 0.05;

        // --- PREPARE WELCOME ELEMENTS ---
        gsap.set([welcomeText, enterButton], {
            y: startY,
            autoAlpha: 0
        });

        // --- DYNAMIC CENTERING CALCULATION ---
        const gap = 48;
        const contentHeight = finalContent.offsetHeight;
        const moveUpDistance = (gap + contentHeight) / 2;

        // --- ANIMATION TIMELINE ---
        tl.add("exitStart")

        // 1. Fade out Loading Text
        .to([leftText, rightText, kannadaText], {
            duration: 1.6,
            y: -50,
            autoAlpha: 0,
            filter: "blur(10px)",
            ease: "expo.inOut"
        }, "exitStart")

        // 2. Move Container UP
        .to(container, {
            duration: 1.6,
            y: `-=${moveUpDistance}`,
            ease: "expo.inOut"
        }, "exitStart")

        // 3. Move Welcome Text UP (Hidden)
        .to([welcomeText, enterButton], {
            duration: 1.6,
            y: 0,
            ease: "expo.inOut",
            stagger: 0
        }, "exitStart")

        // 4. Reveal Welcome Text & Button
        .to([welcomeText, enterButton], {
            duration: 0.8,
            autoAlpha: 1,
            filter: "blur(0px)",
            ease: "power2.out",
            stagger: 0,
            // CRITICAL: Clear 'transform' to allow CSS scale() to take over fully
            clearProps: "filter,transform"
        }, "exitStart+=0.7");
    }

    // --- APP LOGIC ---
    let colorInterval;
    let lastColorIndex = 0;

    function startAppLogic() {
        startCounter();
    }

    function startColorCycle() {
        if (colorInterval) clearInterval(colorInterval);

        const setRandomColor = () => {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * preloadColors.length);
            } while (newIndex === lastColorIndex);
            lastColorIndex = newIndex;
            logoWrapperEl.style.backgroundColor = preloadColors[newIndex];
        };
        setRandomColor();
        colorInterval = setInterval(setRandomColor, 300);
    }

    function stopColorCycle() {
        clearInterval(colorInterval);
    }

    function startCounter() {
        const progress = { val: 0 };
        let hasStartedColors = false;

        gsap.to(progress, {
            val: 100,
            duration: 3,
            ease: "expo.inOut",
            onUpdate: function() {
                const currentVal = Math.floor(progress.val);
                counterEl.textContent = toKannadaNum(currentVal);

                if (!hasStartedColors && currentVal > 0) {
                    hasStartedColors = true;
                    startColorCycle();
                }
            },
            onComplete: function() {
                stopColorCycle();
                runExitAnimation();
            }
        });
    }

    // --- INIT ---
    fetch('assets/metal.svg')
        .then(response => response.text())
        .then(svgContent => {
            document.getElementById('logoWrapper').innerHTML = svgContent;
            runIntroAnimation();
            if (window.initSVGLights) window.initSVGLights();
        })
        .catch(err => {
            console.error('Error loading SVG:', err);
            startAppLogic();
        });

</script>
<script src="script.js"></script>
</body>
</html>